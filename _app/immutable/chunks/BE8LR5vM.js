import{f as j,e as x,a as S,t as G,n as ht}from"./DiEoHLWY.js";import{i as ft}from"./BLe4bZYQ.js";import{F as mt,f as T,t as D,J as _t,ad as se,a1 as P,a2 as Dt,g,s as rt,c as R,r as W,a5 as U,a4 as k,a3 as Z,d as Ft,n as qt}from"./BHJvm40H.js";import{s as dt}from"./CoS6JQuK.js";import{l as J,p as z,i as A,s as st,c as Wt,b as Bt}from"./CL9IDPk4.js";import{b,s as H,t as O,a as ie,c as it}from"./DqzawnL3.js";import{g as oe}from"./ZSLJ2rFA.js";import{b as Kt}from"./BUkJvx_-.js";var re=G("<a></a>"),ae=G("<div></div>");function le(o,t){const e=J(t,["children","$$slots","$$events","$$legacy"]),n=J(e,["href","size"]);mt(t,!1);let s=z(t,"href",8,void 0),i=z(t,"size",8,"default");ft();var l=j(),a=T(l);A(a,s,c=>{var r=re();let d;r.textContent="",D(()=>{d=H(r,d,{href:s(),rel:n.target==="_blank"?"noopener noreferrer":void 0,role:"button",...n}),O(r,"bx--skeleton",!0),O(r,"bx--btn",!0),O(r,"bx--btn--field",i()==="field"),O(r,"bx--btn--sm",i()==="small"),O(r,"bx--btn--lg",i()==="lg"),O(r,"bx--btn--xl",i()==="xl")}),x("click",r,function(u){b.call(this,t,u)}),x("focus",r,function(u){b.call(this,t,u)}),x("blur",r,function(u){b.call(this,t,u)}),x("mouseover",r,function(u){b.call(this,t,u)}),x("mouseenter",r,function(u){b.call(this,t,u)}),x("mouseleave",r,function(u){b.call(this,t,u)}),S(c,r)},c=>{var r=ae();let d;D(()=>{d=H(r,d,{...n}),O(r,"bx--skeleton",!0),O(r,"bx--btn",!0),O(r,"bx--btn--field",i()==="field"),O(r,"bx--btn--sm",i()==="small"),O(r,"bx--btn--lg",i()==="lg"),O(r,"bx--btn--xl",i()==="xl")}),x("click",r,function(u){b.call(this,t,u)}),x("focus",r,function(u){b.call(this,t,u)}),x("blur",r,function(u){b.call(this,t,u)}),x("mouseover",r,function(u){b.call(this,t,u)}),x("mouseenter",r,function(u){b.call(this,t,u)}),x("mouseleave",r,function(u){b.call(this,t,u)}),S(c,r)}),S(o,l),_t()}var ce=G("<span> </span>"),de=G("<a><!> <!> <!></a>"),ue=G("<span> </span>"),he=G("<button><!> <!> <!></button>");function We(o,t){const e=ie(t),n=J(t,["children","$$slots","$$events","$$legacy"]),s=J(n,["kind","size","expressive","isSelected","icon","iconDescription","tooltipAlignment","tooltipPosition","as","skeleton","disabled","href","tabindex","type","ref"]);mt(t,!1);const i=U(),l=U(),a=U();let c=z(t,"kind",8,"primary"),r=z(t,"size",8,"default"),d=z(t,"expressive",8,!1),u=z(t,"isSelected",8,!1),h=z(t,"icon",8,void 0),_=z(t,"iconDescription",8,void 0),p=z(t,"tooltipAlignment",8,"center"),m=z(t,"tooltipPosition",8,"bottom"),v=z(t,"as",8,!1),L=z(t,"skeleton",8,!1),F=z(t,"disabled",8,!1),E=z(t,"href",8,void 0),K=z(t,"tabindex",8,"0"),Q=z(t,"type",8,"button"),I=z(t,"ref",12,null);const N=se("ComposedModal");P(()=>k(I()),()=>{N&&I()&&N.declareRef(I())}),P(()=>k(h()),()=>{Z(i,(h()||e.icon)&&!e.default)}),P(()=>k(_()),()=>{Z(l,{"aria-hidden":"true",class:"bx--btn__icon","aria-label":_()})}),P(()=>(k(E()),k(F()),k(Q()),k(K()),g(i),k(c()),k(u()),k(s),k(d()),k(r()),k(m()),k(p())),()=>{Z(a,{type:E()&&!F()?void 0:Q(),tabindex:K(),disabled:F()===!0?!0:void 0,href:E(),"aria-pressed":g(i)&&c()==="ghost"&&!E()?u():void 0,...s,class:["bx--btn",d()&&"bx--btn--expressive",(r()==="small"&&!d()||r()==="sm"&&!d()||r()==="small"&&!d())&&"bx--btn--sm",r()==="field"&&!d()||r()==="md"&&!d()&&"bx--btn--md",r()==="field"&&"bx--btn--field",r()==="small"&&"bx--btn--sm",r()==="lg"&&"bx--btn--lg",r()==="xl"&&"bx--btn--xl",c()&&`bx--btn--${c()}`,F()&&"bx--btn--disabled",g(i)&&"bx--btn--icon-only",g(i)&&"bx--tooltip__trigger",g(i)&&"bx--tooltip--a11y",g(i)&&m()&&`bx--btn--icon-only--${m()}`,g(i)&&p()&&`bx--tooltip--align-${p()}`,g(i)&&u()&&c()==="ghost"&&"bx--btn--selected",s.class].filter(Boolean).join(" ")})}),Dt(),ft();var Rt=j(),ne=T(Rt);A(ne,L,gt=>{var ot=Ft(()=>g(i)&&"width: 3rem;");le(gt,st({get href(){return E()},get size(){return r()}},()=>s,{get style(){return g(ot)},$$events:{click(C){b.call(this,t,C)},focus(C){b.call(this,t,C)},blur(C){b.call(this,t,C)},mouseover(C){b.call(this,t,C)},mouseenter(C){b.call(this,t,C)},mouseleave(C){b.call(this,t,C)}}}))},gt=>{var ot=j(),C=T(ot);A(C,v,bt=>{var X=j(),pt=T(X);it(pt,t,"default",{get props(){return g(a)}},null),S(bt,X)},bt=>{var X=j(),pt=T(X);A(pt,()=>E()&&!F(),vt=>{var y=de();let $;var tt=R(y);A(tt,()=>g(i),f=>{var w=ce();O(w,"bx--assistive-text",!0);var V=R(w,!0);W(w),D(()=>dt(V,_())),S(f,w)});var et=rt(tt,2);it(et,t,"default",{},null);var xt=rt(et,2);A(xt,()=>e.icon,f=>{var w=j(),V=T(w);it(V,t,"icon",st({get style(){return g(i)?"margin-left: 0":void 0}},()=>g(l)),null),S(f,w)},f=>{var w=j(),V=T(w);A(V,h,yt=>{var nt=j(),wt=T(nt),zt=Ft(()=>g(i)?"margin-left: 0":void 0);Wt(wt,h,(St,kt)=>{kt(St,st({get style(){return g(zt)}},()=>g(l)))}),S(yt,nt)},null,!0),S(f,w)}),W(y),Bt(y,f=>I(f),()=>I()),D(()=>$=H(y,$,{...g(a)})),x("click",y,function(f){b.call(this,t,f)}),x("focus",y,function(f){b.call(this,t,f)}),x("blur",y,function(f){b.call(this,t,f)}),x("mouseover",y,function(f){b.call(this,t,f)}),x("mouseenter",y,function(f){b.call(this,t,f)}),x("mouseleave",y,function(f){b.call(this,t,f)}),S(vt,y)},vt=>{var y=he();let $;var tt=R(y);A(tt,()=>g(i),f=>{var w=ue();O(w,"bx--assistive-text",!0);var V=R(w,!0);W(w),D(()=>dt(V,_())),S(f,w)});var et=rt(tt,2);it(et,t,"default",{},null);var xt=rt(et,2);A(xt,()=>e.icon,f=>{var w=j(),V=T(w);it(V,t,"icon",st({get style(){return g(i)?"margin-left: 0":void 0}},()=>g(l)),null),S(f,w)},f=>{var w=j(),V=T(w);A(V,h,yt=>{var nt=j(),wt=T(nt),zt=Ft(()=>g(i)?"margin-left: 0":void 0);Wt(wt,h,(St,kt)=>{kt(St,st({get style(){return g(zt)}},()=>g(l)))}),S(yt,nt)},null,!0),S(f,w)}),W(y),Bt(y,f=>I(f),()=>I()),D(()=>$=H(y,$,{...g(a)})),x("click",y,function(f){b.call(this,t,f)}),x("focus",y,function(f){b.call(this,t,f)}),x("blur",y,function(f){b.call(this,t,f)}),x("mouseover",y,function(f){b.call(this,t,f)}),x("mouseenter",y,function(f){b.call(this,t,f)}),x("mouseleave",y,function(f){b.call(this,t,f)}),S(vt,y)},!0),S(bt,X)},!0),S(gt,ot)}),S(o,Rt),_t()}var fe=ht("<title> </title>"),me=ht('<svg><!><path d="M16,2C8.3,2,2,8.3,2,16s6.3,14,14,14s14-6.3,14-14C30,8.3,23.7,2,16,2z M14.9,8h2.2v11h-2.2V8z M16,25	c-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22c0.8,0,1.5,0.7,1.5,1.5S16.8,25,16,25z"></path><path fill="none" d="M17.5,23.5c0,0.8-0.7,1.5-1.5,1.5c-0.8,0-1.5-0.7-1.5-1.5S15.2,22,16,22	C16.8,22,17.5,22.7,17.5,23.5z M17.1,8h-2.2v11h2.2V8z" data-icon-path="inner-path" opacity="0"></path></svg>');function Be(o,t){const e=J(t,["children","$$slots","$$events","$$legacy"]),n=J(e,["size","title"]);mt(t,!1);const s=U(),i=U();let l=z(t,"size",8,16),a=z(t,"title",8,void 0);P(()=>(k(e),k(a())),()=>{Z(s,e["aria-label"]||e["aria-labelledby"]||a())}),P(()=>(g(s),k(e)),()=>{Z(i,{"aria-hidden":g(s)?void 0:!0,role:g(s)?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})}),Dt(),ft();var c=me();let r;var d=R(c);A(d,a,u=>{var h=fe(),_=R(h,!0);W(h),D(()=>dt(_,a())),S(u,h)}),qt(2),W(c),D(()=>r=H(c,r,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",preserveAspectRatio:"xMidYMid meet",width:l(),height:l(),...g(i),...n},void 0,!0)),S(o,c),_t()}var _e=ht("<title> </title>"),ge=ht('<svg><!><path fill="none" d="M16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Zm-1.125-5h2.25V12h-2.25Z" data-icon-path="inner-path"></path><path d="M16.002,6.1714h-.004L4.6487,27.9966,4.6506,28H27.3494l.0019-.0034ZM14.875,12h2.25v9h-2.25ZM16,26a1.5,1.5,0,1,1,1.5-1.5A1.5,1.5,0,0,1,16,26Z"></path><path d="M29,30H3a1,1,0,0,1-.8872-1.4614l13-25a1,1,0,0,1,1.7744,0l13,25A1,1,0,0,1,29,30ZM4.6507,28H27.3493l.002-.0033L16.002,6.1714h-.004L4.6487,27.9967Z"></path></svg>');function Je(o,t){const e=J(t,["children","$$slots","$$events","$$legacy"]),n=J(e,["size","title"]);mt(t,!1);const s=U(),i=U();let l=z(t,"size",8,16),a=z(t,"title",8,void 0);P(()=>(k(e),k(a())),()=>{Z(s,e["aria-label"]||e["aria-labelledby"]||a())}),P(()=>(g(s),k(e)),()=>{Z(i,{"aria-hidden":g(s)?void 0:!0,role:g(s)?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})}),Dt(),ft();var c=ge();let r;var d=R(c);A(d,a,u=>{var h=_e(),_=R(h,!0);W(h),D(()=>dt(_,a())),S(u,h)}),qt(3),W(c),D(()=>r=H(c,r,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",fill:"currentColor",preserveAspectRatio:"xMidYMid meet",width:l(),height:l(),...g(i),...n},void 0,!0)),S(o,c),_t()}const At={id:{text:"A-Number",keypath:"id"},page_count:{text:"Page Count",keypath:"page_count"},last_name_nara:{text:"Last Name (NARA)",keypath:"fields.last_name.nara"},first_name_nara:{text:"First Name (NARA)",keypath:"fields.first_name.nara"},dob_nara:{text:"Date of Birth (NARA)",keypath:"fields.dob.nara"},doe_nara:{text:"Date of Entry (NARA)",keypath:"fields.doe.nara"},poe_nara:{text:"Port of Entry (NARA)",keypath:"fields.poe.nara"},cob_nara:{text:"Country of Birth (NARA)",keypath:"fields.cob.nara"},sex_nara:{text:"Sex (NARA)",keypath:"fields.sex.nara"},sex_ms:{text:"Sex (LLM)",keypath:"fields.sex.ms_sex_llm_v1"},form_titles_llm:{text:"Form Titles (LLM)",keypath:"fields.form_titles.ms_form_titles_llm_v1"},countries_nlp:{text:"Countries (LLM)",keypath:"fields.countries.ms_countries_nlp_v1"}},Vt={id:{text:"Page ID",keypath:"id"},anumber:{text:"A-Number",keypath:"anumber"},full_text:{text:"Full Text (OCR)",keypath:"full_text"},sex_ms:{text:"Sex (LLM)",keypath:"fields.sex.ms_sex_llm_v1"},doctype_ms:{text:"Document Type (LLM)",keypath:"fields.doctype.ms_doctype_llm_v1"},form_title_llm:{text:"Form Title (LLM)",keypath:"fields.form_title.ms_form_title_llm_v1"},countries_nlp:{text:"Countries (NLP)",keypath:"fields.countries.ms_countries_nlp_v1"},years_nlp:{text:"Years (NLP)",keypath:"fields.years.ms_years_nlp_v1"}},be={afile:At,page:Vt},pe=["anumber","form_title_llm","countries_nlp","years_nlp","full_text"].map(o=>({id:o,text:Vt[o].text,keypath:Vt[o].keypath})),ve=["id","form_titles_llm","countries_nlp","last_name_nara","first_name_nara","poe_nara","cob_nara"].map(o=>({id:o,text:At[o].text,keypath:At[o].keypath})),Qe={afile:ve,page:pe};function ct(o,t,e,n){function s(i){return i instanceof e?i:new e(function(l){l(i)})}return new(e||(e=Promise))(function(i,l){function a(d){try{r(n.next(d))}catch(u){l(u)}}function c(d){try{r(n.throw(d))}catch(u){l(u)}}function r(d){d.done?i(d.value):s(d.value).then(a,c)}r((n=n.apply(o,[])).next())})}const xe="ENTRIES",Yt="KEYS",Ht="VALUES",M="";class Mt{constructor(t,e){const n=t._tree,s=Array.from(n.keys());this.set=t,this._type=e,this._path=s.length>0?[{node:n,keys:s}]:[]}next(){const t=this.dive();return this.backtrack(),t}dive(){if(this._path.length===0)return{done:!0,value:void 0};const{node:t,keys:e}=Y(this._path);if(Y(e)===M)return{done:!1,value:this.result()};const n=t.get(Y(e));return this._path.push({node:n,keys:Array.from(n.keys())}),this.dive()}backtrack(){if(this._path.length===0)return;const t=Y(this._path).keys;t.pop(),!(t.length>0)&&(this._path.pop(),this.backtrack())}key(){return this.set._prefix+this._path.map(({keys:t})=>Y(t)).filter(t=>t!==M).join("")}value(){return Y(this._path).node.get(M)}result(){switch(this._type){case Ht:return this.value();case Yt:return this.key();default:return[this.key(),this.value()]}}[Symbol.iterator](){return this}}const Y=o=>o[o.length-1],ye=(o,t,e)=>{const n=new Map;if(t===void 0)return n;const s=t.length+1,i=s+e,l=new Uint8Array(i*s).fill(e+1);for(let a=0;a<s;++a)l[a]=a;for(let a=1;a<i;++a)l[a*s]=a;return Gt(o,t,e,n,l,1,s,""),n},Gt=(o,t,e,n,s,i,l,a)=>{const c=i*l;t:for(const r of o.keys())if(r===M){const d=s[c-1];d<=e&&n.set(a,[o.get(r),d])}else{let d=i;for(let u=0;u<r.length;++u,++d){const h=r[u],_=l*d,p=_-l;let m=s[_];const v=Math.max(0,d-e-1),L=Math.min(l-1,d+e);for(let F=v;F<L;++F){const E=h!==t[F],K=s[p+F]+ +E,Q=s[p+F+1]+1,I=s[_+F]+1,N=s[_+F+1]=Math.min(K,Q,I);N<m&&(m=N)}if(m>e)continue t}Gt(o.get(r),t,e,n,s,d,l,a+r)}};class B{constructor(t=new Map,e=""){this._size=void 0,this._tree=t,this._prefix=e}atPrefix(t){if(!t.startsWith(this._prefix))throw new Error("Mismatched prefix");const[e,n]=ut(this._tree,t.slice(this._prefix.length));if(e===void 0){const[s,i]=Nt(n);for(const l of s.keys())if(l!==M&&l.startsWith(i)){const a=new Map;return a.set(l.slice(i.length),s.get(l)),new B(a,t)}}return new B(e,t)}clear(){this._size=void 0,this._tree.clear()}delete(t){return this._size=void 0,we(this._tree,t)}entries(){return new Mt(this,xe)}forEach(t){for(const[e,n]of this)t(e,n,this)}fuzzyGet(t,e){return ye(this._tree,t,e)}get(t){const e=jt(this._tree,t);return e!==void 0?e.get(M):void 0}has(t){const e=jt(this._tree,t);return e!==void 0&&e.has(M)}keys(){return new Mt(this,Yt)}set(t,e){if(typeof t!="string")throw new Error("key must be a string");return this._size=void 0,It(this._tree,t).set(M,e),this}get size(){if(this._size)return this._size;this._size=0;const t=this.entries();for(;!t.next().done;)this._size+=1;return this._size}update(t,e){if(typeof t!="string")throw new Error("key must be a string");this._size=void 0;const n=It(this._tree,t);return n.set(M,e(n.get(M))),this}fetch(t,e){if(typeof t!="string")throw new Error("key must be a string");this._size=void 0;const n=It(this._tree,t);let s=n.get(M);return s===void 0&&n.set(M,s=e()),s}values(){return new Mt(this,Ht)}[Symbol.iterator](){return this.entries()}static from(t){const e=new B;for(const[n,s]of t)e.set(n,s);return e}static fromObject(t){return B.from(Object.entries(t))}}const ut=(o,t,e=[])=>{if(t.length===0||o==null)return[o,e];for(const n of o.keys())if(n!==M&&t.startsWith(n))return e.push([o,n]),ut(o.get(n),t.slice(n.length),e);return e.push([o,t]),ut(void 0,"",e)},jt=(o,t)=>{if(t.length===0||o==null)return o;for(const e of o.keys())if(e!==M&&t.startsWith(e))return jt(o.get(e),t.slice(e.length))},It=(o,t)=>{const e=t.length;t:for(let n=0;o&&n<e;){for(const i of o.keys())if(i!==M&&t[n]===i[0]){const l=Math.min(e-n,i.length);let a=1;for(;a<l&&t[n+a]===i[a];)++a;const c=o.get(i);if(a===i.length)o=c;else{const r=new Map;r.set(i.slice(a),c),o.set(t.slice(n,n+a),r),o.delete(i),o=r}n+=a;continue t}const s=new Map;return o.set(t.slice(n),s),s}return o},we=(o,t)=>{const[e,n]=ut(o,t);if(e!==void 0){if(e.delete(M),e.size===0)Xt(n);else if(e.size===1){const[s,i]=e.entries().next().value;$t(n,s,i)}}},Xt=o=>{if(o.length===0)return;const[t,e]=Nt(o);if(t.delete(e),t.size===0)Xt(o.slice(0,-1));else if(t.size===1){const[n,s]=t.entries().next().value;n!==M&&$t(o.slice(0,-1),n,s)}},$t=(o,t,e)=>{if(o.length===0)return;const[n,s]=Nt(o);n.set(s+t,e),n.delete(s)},Nt=o=>o[o.length-1],Pt="or",te="and",ze="and_not";class q{constructor(t){if((t==null?void 0:t.fields)==null)throw new Error('MiniSearch: option "fields" must be provided');const e=t.autoVacuum==null||t.autoVacuum===!0?Lt:t.autoVacuum;this._options=Object.assign(Object.assign(Object.assign({},Ct),t),{autoVacuum:e,searchOptions:Object.assign(Object.assign({},Jt),t.searchOptions||{}),autoSuggestOptions:Object.assign(Object.assign({},Ie),t.autoSuggestOptions||{})}),this._index=new B,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=Et,this.addFields(this._options.fields)}add(t){const{extractField:e,tokenize:n,processTerm:s,fields:i,idField:l}=this._options,a=e(t,l);if(a==null)throw new Error(`MiniSearch: document does not have ID field "${l}"`);if(this._idToShortId.has(a))throw new Error(`MiniSearch: duplicate ID ${a}`);const c=this.addDocumentId(a);this.saveStoredFields(c,t);for(const r of i){const d=e(t,r);if(d==null)continue;const u=n(d.toString(),r),h=this._fieldIds[r],_=new Set(u).size;this.addFieldLength(c,h,this._documentCount-1,_);for(const p of u){const m=s(p,r);if(Array.isArray(m))for(const v of m)this.addTerm(h,c,v);else m&&this.addTerm(h,c,m)}}}addAll(t){for(const e of t)this.add(e)}addAllAsync(t,e={}){const{chunkSize:n=10}=e,s={chunk:[],promise:Promise.resolve()},{chunk:i,promise:l}=t.reduce(({chunk:a,promise:c},r,d)=>(a.push(r),(d+1)%n===0?{chunk:[],promise:c.then(()=>new Promise(u=>setTimeout(u,0))).then(()=>this.addAll(a))}:{chunk:a,promise:c}),s);return l.then(()=>this.addAll(i))}remove(t){const{tokenize:e,processTerm:n,extractField:s,fields:i,idField:l}=this._options,a=s(t,l);if(a==null)throw new Error(`MiniSearch: document does not have ID field "${l}"`);const c=this._idToShortId.get(a);if(c==null)throw new Error(`MiniSearch: cannot remove document with ID ${a}: it is not in the index`);for(const r of i){const d=s(t,r);if(d==null)continue;const u=e(d.toString(),r),h=this._fieldIds[r],_=new Set(u).size;this.removeFieldLength(c,h,this._documentCount,_);for(const p of u){const m=n(p,r);if(Array.isArray(m))for(const v of m)this.removeTerm(h,c,v);else m&&this.removeTerm(h,c,m)}}this._storedFields.delete(c),this._documentIds.delete(c),this._idToShortId.delete(a),this._fieldLength.delete(c),this._documentCount-=1}removeAll(t){if(t)for(const e of t)this.remove(e);else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new B,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}}discard(t){const e=this._idToShortId.get(t);if(e==null)throw new Error(`MiniSearch: cannot discard document with ID ${t}: it is not in the index`);this._idToShortId.delete(t),this._documentIds.delete(e),this._storedFields.delete(e),(this._fieldLength.get(e)||[]).forEach((n,s)=>{this.removeFieldLength(e,s,this._documentCount,n)}),this._fieldLength.delete(e),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()}maybeAutoVacuum(){if(this._options.autoVacuum===!1)return;const{minDirtFactor:t,minDirtCount:e,batchSize:n,batchWait:s}=this._options.autoVacuum;this.conditionalVacuum({batchSize:n,batchWait:s},{minDirtCount:e,minDirtFactor:t})}discardAll(t){const e=this._options.autoVacuum;try{this._options.autoVacuum=!1;for(const n of t)this.discard(n)}finally{this._options.autoVacuum=e}this.maybeAutoVacuum()}replace(t){const{idField:e,extractField:n}=this._options,s=n(t,e);this.discard(s),this.add(t)}vacuum(t={}){return this.conditionalVacuum(t)}conditionalVacuum(t,e){return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&e,this._enqueuedVacuum!=null?this._enqueuedVacuum:(this._enqueuedVacuum=this._currentVacuum.then(()=>{const n=this._enqueuedVacuumConditions;return this._enqueuedVacuumConditions=Et,this.performVacuuming(t,n)}),this._enqueuedVacuum)):this.vacuumConditionsMet(e)===!1?Promise.resolve():(this._currentVacuum=this.performVacuuming(t),this._currentVacuum)}performVacuuming(t,e){return ct(this,void 0,void 0,function*(){const n=this._dirtCount;if(this.vacuumConditionsMet(e)){const s=t.batchSize||Tt.batchSize,i=t.batchWait||Tt.batchWait;let l=1;for(const[a,c]of this._index){for(const[r,d]of c)for(const[u]of d)this._documentIds.has(u)||(d.size<=1?c.delete(r):d.delete(u));this._index.get(a).size===0&&this._index.delete(a),l%s===0&&(yield new Promise(r=>setTimeout(r,i))),l+=1}this._dirtCount-=n}yield null,this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null})}vacuumConditionsMet(t){if(t==null)return!0;let{minDirtCount:e,minDirtFactor:n}=t;return e=e||Lt.minDirtCount,n=n||Lt.minDirtFactor,this.dirtCount>=e&&this.dirtFactor>=n}get isVacuuming(){return this._currentVacuum!=null}get dirtCount(){return this._dirtCount}get dirtFactor(){return this._dirtCount/(1+this._documentCount+this._dirtCount)}has(t){return this._idToShortId.has(t)}getStoredFields(t){const e=this._idToShortId.get(t);if(e!=null)return this._storedFields.get(e)}search(t,e={}){const{searchOptions:n}=this._options,s=Object.assign(Object.assign({},n),e),i=this.executeQuery(t,e),l=[];for(const[a,{score:c,terms:r,match:d}]of i){const u=r.length||1,h={id:this._documentIds.get(a),score:c*u,terms:Object.keys(d),queryTerms:r,match:d};Object.assign(h,this._storedFields.get(a)),(s.filter==null||s.filter(h))&&l.push(h)}return t===q.wildcard&&s.boostDocument==null||l.sort(Ut),l}autoSuggest(t,e={}){e=Object.assign(Object.assign({},this._options.autoSuggestOptions),e);const n=new Map;for(const{score:i,terms:l}of this.search(t,e)){const a=l.join(" "),c=n.get(a);c!=null?(c.score+=i,c.count+=1):n.set(a,{score:i,terms:l,count:1})}const s=[];for(const[i,{score:l,terms:a,count:c}]of n)s.push({suggestion:i,terms:a,score:l/c});return s.sort(Ut),s}get documentCount(){return this._documentCount}get termCount(){return this._index.size}static loadJSON(t,e){if(e==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(t),e)}static loadJSONAsync(t,e){return ct(this,void 0,void 0,function*(){if(e==null)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJSAsync(JSON.parse(t),e)})}static getDefault(t){if(Ct.hasOwnProperty(t))return Ot(Ct,t);throw new Error(`MiniSearch: unknown option "${t}"`)}static loadJS(t,e){const{index:n,documentIds:s,fieldLength:i,storedFields:l,serializationVersion:a}=t,c=this.instantiateMiniSearch(t,e);c._documentIds=at(s),c._fieldLength=at(i),c._storedFields=at(l);for(const[r,d]of c._documentIds)c._idToShortId.set(d,r);for(const[r,d]of n){const u=new Map;for(const h of Object.keys(d)){let _=d[h];a===1&&(_=_.ds),u.set(parseInt(h,10),at(_))}c._index.set(r,u)}return c}static loadJSAsync(t,e){return ct(this,void 0,void 0,function*(){const{index:n,documentIds:s,fieldLength:i,storedFields:l,serializationVersion:a}=t,c=this.instantiateMiniSearch(t,e);c._documentIds=yield lt(s),c._fieldLength=yield lt(i),c._storedFields=yield lt(l);for(const[d,u]of c._documentIds)c._idToShortId.set(u,d);let r=0;for(const[d,u]of n){const h=new Map;for(const _ of Object.keys(u)){let p=u[_];a===1&&(p=p.ds),h.set(parseInt(_,10),yield lt(p))}++r%1e3===0&&(yield ee(0)),c._index.set(d,h)}return c})}static instantiateMiniSearch(t,e){const{documentCount:n,nextId:s,fieldIds:i,averageFieldLength:l,dirtCount:a,serializationVersion:c}=t;if(c!==1&&c!==2)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");const r=new q(e);return r._documentCount=n,r._nextId=s,r._idToShortId=new Map,r._fieldIds=i,r._avgFieldLength=l,r._dirtCount=a||0,r._index=new B,r}executeQuery(t,e={}){if(t===q.wildcard)return this.executeWildcardQuery(e);if(typeof t!="string"){const h=Object.assign(Object.assign(Object.assign({},e),t),{queries:void 0}),_=t.queries.map(p=>this.executeQuery(p,h));return this.combineResults(_,h.combineWith)}const{tokenize:n,processTerm:s,searchOptions:i}=this._options,l=Object.assign(Object.assign({tokenize:n,processTerm:s},i),e),{tokenize:a,processTerm:c}=l,u=a(t).flatMap(h=>c(h)).filter(h=>!!h).map(Me(l)).map(h=>this.executeQuerySpec(h,l));return this.combineResults(u,l.combineWith)}executeQuerySpec(t,e){const n=Object.assign(Object.assign({},this._options.searchOptions),e),s=(n.fields||this._options.fields).reduce((m,v)=>Object.assign(Object.assign({},m),{[v]:Ot(n.boost,v)||1}),{}),{boostDocument:i,weights:l,maxFuzzy:a,bm25:c}=n,{fuzzy:r,prefix:d}=Object.assign(Object.assign({},Jt.weights),l),u=this._index.get(t.term),h=this.termResults(t.term,t.term,1,t.termBoost,u,s,i,c);let _,p;if(t.prefix&&(_=this._index.atPrefix(t.term)),t.fuzzy){const m=t.fuzzy===!0?.2:t.fuzzy,v=m<1?Math.min(a,Math.round(t.term.length*m)):m;v&&(p=this._index.fuzzyGet(t.term,v))}if(_)for(const[m,v]of _){const L=m.length-t.term.length;if(!L)continue;p==null||p.delete(m);const F=d*m.length/(m.length+.3*L);this.termResults(t.term,m,F,t.termBoost,v,s,i,c,h)}if(p)for(const m of p.keys()){const[v,L]=p.get(m);if(!L)continue;const F=r*m.length/(m.length+L);this.termResults(t.term,m,F,t.termBoost,v,s,i,c,h)}return h}executeWildcardQuery(t){const e=new Map,n=Object.assign(Object.assign({},this._options.searchOptions),t);for(const[s,i]of this._documentIds){const l=n.boostDocument?n.boostDocument(i,"",this._storedFields.get(s)):1;e.set(s,{score:l,terms:[],match:{}})}return e}combineResults(t,e=Pt){if(t.length===0)return new Map;const n=e.toLowerCase(),s=Se[n];if(!s)throw new Error(`Invalid combination operator: ${e}`);return t.reduce(s)||new Map}toJSON(){const t=[];for(const[e,n]of this._index){const s={};for(const[i,l]of n)s[i]=Object.fromEntries(l);t.push([e,s])}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:t,serializationVersion:2}}termResults(t,e,n,s,i,l,a,c,r=new Map){if(i==null)return r;for(const d of Object.keys(l)){const u=l[d],h=this._fieldIds[d],_=i.get(h);if(_==null)continue;let p=_.size;const m=this._avgFieldLength[h];for(const v of _.keys()){if(!this._documentIds.has(v)){this.removeTerm(h,v,e),p-=1;continue}const L=a?a(this._documentIds.get(v),e,this._storedFields.get(v)):1;if(!L)continue;const F=_.get(v),E=this._fieldLength.get(v)[h],K=Fe(F,p,this._documentCount,E,m,c),Q=n*s*u*L*K,I=r.get(v);if(I){I.score+=Q,Oe(I.terms,t);const N=Ot(I.match,e);N?N.push(d):I.match[e]=[d]}else r.set(v,{score:Q,terms:[t],match:{[e]:[d]}})}}return r}addTerm(t,e,n){const s=this._index.fetch(n,Zt);let i=s.get(t);if(i==null)i=new Map,i.set(e,1),s.set(t,i);else{const l=i.get(e);i.set(e,(l||0)+1)}}removeTerm(t,e,n){if(!this._index.has(n)){this.warnDocumentChanged(e,t,n);return}const s=this._index.fetch(n,Zt),i=s.get(t);i==null||i.get(e)==null?this.warnDocumentChanged(e,t,n):i.get(e)<=1?i.size<=1?s.delete(t):i.delete(e):i.set(e,i.get(e)-1),this._index.get(n).size===0&&this._index.delete(n)}warnDocumentChanged(t,e,n){for(const s of Object.keys(this._fieldIds))if(this._fieldIds[s]===e){this._options.logger("warn",`MiniSearch: document with ID ${this._documentIds.get(t)} has changed before removal: term "${n}" was not present in field "${s}". Removing a document after it has changed can corrupt the index!`,"version_conflict");return}}addDocumentId(t){const e=this._nextId;return this._idToShortId.set(t,e),this._documentIds.set(e,t),this._documentCount+=1,this._nextId+=1,e}addFields(t){for(let e=0;e<t.length;e++)this._fieldIds[t[e]]=e}addFieldLength(t,e,n,s){let i=this._fieldLength.get(t);i==null&&this._fieldLength.set(t,i=[]),i[e]=s;const a=(this._avgFieldLength[e]||0)*n+s;this._avgFieldLength[e]=a/(n+1)}removeFieldLength(t,e,n,s){if(n===1){this._avgFieldLength[e]=0;return}const i=this._avgFieldLength[e]*n-s;this._avgFieldLength[e]=i/(n-1)}saveStoredFields(t,e){const{storeFields:n,extractField:s}=this._options;if(n==null||n.length===0)return;let i=this._storedFields.get(t);i==null&&this._storedFields.set(t,i={});for(const l of n){const a=s(e,l);a!==void 0&&(i[l]=a)}}}q.wildcard=Symbol("*");const Ot=(o,t)=>Object.prototype.hasOwnProperty.call(o,t)?o[t]:void 0,Se={[Pt]:(o,t)=>{for(const e of t.keys()){const n=o.get(e);if(n==null)o.set(e,t.get(e));else{const{score:s,terms:i,match:l}=t.get(e);n.score=n.score+s,n.match=Object.assign(n.match,l),Qt(n.terms,i)}}return o},[te]:(o,t)=>{const e=new Map;for(const n of t.keys()){const s=o.get(n);if(s==null)continue;const{score:i,terms:l,match:a}=t.get(n);Qt(s.terms,l),e.set(n,{score:s.score+i,terms:s.terms,match:Object.assign(s.match,a)})}return e},[ze]:(o,t)=>{for(const e of t.keys())o.delete(e);return o}},ke={k:1.2,b:.7,d:.5},Fe=(o,t,e,n,s,i)=>{const{k:l,b:a,d:c}=i;return Math.log(1+(e-t+.5)/(t+.5))*(c+o*(l+1)/(o+l*(1-a+a*n/s)))},Me=o=>(t,e,n)=>{const s=typeof o.fuzzy=="function"?o.fuzzy(t,e,n):o.fuzzy||!1,i=typeof o.prefix=="function"?o.prefix(t,e,n):o.prefix===!0,l=typeof o.boostTerm=="function"?o.boostTerm(t,e,n):1;return{term:t,fuzzy:s,prefix:i,termBoost:l}},Ct={idField:"id",extractField:(o,t)=>o[t],tokenize:o=>o.split(Ce),processTerm:o=>o.toLowerCase(),fields:void 0,searchOptions:void 0,storeFields:[],logger:(o,t)=>{typeof(console==null?void 0:console[o])=="function"&&console[o](t)},autoVacuum:!0},Jt={combineWith:Pt,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:ke},Ie={combineWith:te,prefix:(o,t,e)=>t===e.length-1},Tt={batchSize:1e3,batchWait:10},Et={minDirtFactor:.1,minDirtCount:20},Lt=Object.assign(Object.assign({},Tt),Et),Oe=(o,t)=>{o.includes(t)||o.push(t)},Qt=(o,t)=>{for(const e of t)o.includes(e)||o.push(e)},Ut=({score:o},{score:t})=>t-o,Zt=()=>new Map,at=o=>{const t=new Map;for(const e of Object.keys(o))t.set(parseInt(e,10),o[e]);return t},lt=o=>ct(void 0,void 0,void 0,function*(){const t=new Map;let e=0;for(const n of Object.keys(o))t.set(parseInt(n,10),o[n]),++e%1e3===0&&(yield ee(0));return t}),ee=o=>new Promise(t=>setTimeout(t,o)),Ce=/[\n\r\p{Z}\p{P}]+/u;function Le(o){return{fields:o,extractField:(t,e)=>e.split(".").reduce((n,s)=>{const i=parseInt(s,10);return n&&n[isNaN(i)?s:i]},t),storeFields:["id","anumber","page_index","full_text","fields"]}}function Ae(o){return{fields:o,extractField:(t,e)=>e.split(".").reduce((n,s)=>{const i=parseInt(s,10);return n&&n[isNaN(i)?s:i]},t),storeFields:["id","fields"]}}async function Ue(o,t){const e=`${Kt}/api/index/${o}.json`,n=t.getAll("selectedFields").map(a=>be[o][a].keypath),s=new q(o=="afile"?Ae(n):Le(n)),i=t.get("query")||q.wildcard;return await fetch(e).then(a=>a.json()).then(a=>(s.addAll(a),console.log("miniSearch",s),s.search(i,{prefix:!0,combine:"AND",fuzzy:.1}))).catch(a=>console.error(a))}function Ze(o){o.preventDefault(),localStorage.setItem("formReferrer",window.location.href);const t=new FormData(o.target),e=o.target.attributes.scope.value,n=new URLSearchParams(t);oe(`${Kt}/results/${e}?${n.toString()}`)}export{We as B,Be as W,Je as a,Qe as f,Ze as h,Ue as s};
